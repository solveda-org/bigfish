<?xml version="1.0" encoding="UTF-8" ?>

<simple-methods xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="http://ofbiz.apache.org/dtds/simple-methods.xsd">

    <simple-method method-name="createProductReview" short-description="Create Product review" login-required="false">

         <call-map-processor in-map-name="parameters" out-map-name="reviewContext">
             <simple-map-processor name="productReview">
                <process field="overallRate"><copy to-field="productRating"/><not-empty><fail-property resource="OSafeUiLabels" property="OverallRatingMissingError"/></not-empty>
                </process>
                <process field="qualityRate"><copy to-field="qualityRating"/></process>
                <process field="effectivenessRate"><copy to-field="effectivenessRating"/></process>
                <process field="satisfactionRate"><copy to-field="satisfactionRating"/></process>
                <process field="productId"><copy to-field="productId"/></process>
                <process field="productStoreId"><copy to-field="productStoreId"/></process>
                <process field="REVIEW_NICK_NAME"><copy to-field="reviewNickName"/><not-empty><fail-property resource="OSafeUiLabels" property="NicknameMissingError"/></not-empty></process>
                <process field="REVIEW_TITLE"><copy to-field="reviewTitle"/><not-empty><fail-property resource="OSafeUiLabels" property="ReviewTitleMissingError"/></not-empty></process>
                <process field="REVIEW_TEXT"><copy to-field="productReview"/><not-empty><fail-property resource="OSafeUiLabels" property="ReviewTextMissingError"/></not-empty></process>
                <process field="REVIEW_GENDER"><copy to-field="reviewGender"/></process>
                <process field="REVIEW_AGE"><copy to-field="reviewAge"/></process>
                <process field="REVIEW_LOCATION"><copy to-field="reviewLocation"/></process>
             </simple-map-processor>

         </call-map-processor>
        <if-not-empty field="parameters.REVIEW_TEXT">
            <call-object-method method-name="length" obj-field="parameters.REVIEW_TEXT" ret-field="reviewTextDataLen"/>
            <if-compare field="reviewTextDataLen" operator="less" value="50" type="Integer">
                <property-to-field field="tempErrorMessage" resource="OSafeUiLabels" property="ReviewTextShortError"/>
                <string-to-list string="${tempErrorMessage}" message-field="REVIEW_TEXT" list="error_list"/>
            </if-compare>
        </if-not-empty>
        <check-errors/>
        <set-service-fields service-name="createProductReview" map="reviewContext" to-map="createReviewCtx"/>
        <if-not-empty field="reviewContext.productRating">
            <set field="createReviewCtx.productRating" type="BigDecimal" value="${reviewContext.productRating}"/>
        </if-not-empty>
        <if-not-empty field="reviewContext.effectivenessRating">
            <set field="createReviewCtx.effectivenessRating" type="BigDecimal" value="${reviewContext.effectivenessRating}"/>
        </if-not-empty>
        <if-not-empty field="reviewContext.qualityRating">
            <set field="createReviewCtx.qualityRating" type="BigDecimal" value="${reviewContext.qualityRating}"/>
        </if-not-empty>

        <if-not-empty field="reviewContext.satisfactionRating">
            <set field="createReviewCtx.satisfactionRating" type="BigDecimal" value="${reviewContext.satisfactionRating}"/>
        </if-not-empty>

        <call-service service-name="createProductReview" in-map-name="createReviewCtx" include-user-login="true"/>

    </simple-method>
</simple-methods>
